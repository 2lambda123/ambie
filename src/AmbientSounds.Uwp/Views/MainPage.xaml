<Page
    x:Class="AmbientSounds.Views.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:animations="using:Microsoft.Toolkit.Uwp.UI.Animations"
    xmlns:controls="using:AmbientSounds.Controls"
    xmlns:converters="using:AmbientSounds.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:extensions="using:Microsoft.Toolkit.Uwp.UI.Extensions"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
    xmlns:statetriggers="using:AmbientSounds.StateTriggers"
    xmlns:viewmodels="using:AmbientSounds.ViewModels"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
    PointerEntered="{x:Bind ViewModel.ResetTime}"
    PointerMoved="{x:Bind ViewModel.ResetTime}"
    PointerPressed="{x:Bind ViewModel.ResetTime}"
    PointerReleased="{x:Bind ViewModel.ResetTime}"
    PreviewKeyDown="{x:Bind ViewModel.ResetTime}"
    mc:Ignorable="d">
    <Page.Resources>
        <ResourceDictionary>
            <ResourceDictionary.ThemeDictionaries>
                <ResourceDictionary x:Key="Light">
                    <LinearGradientBrush x:Key="HeaderGradient" StartPoint="0.5,0" EndPoint="0.5,1">
                        <GradientStop Offset="0" Color="White" />
                        <GradientStop Offset="1" Color="Transparent" />
                    </LinearGradientBrush>
                </ResourceDictionary>
                <ResourceDictionary x:Key="Dark">
                    <LinearGradientBrush x:Key="HeaderGradient" StartPoint="0.5,0" EndPoint="0.5,1">
                        <GradientStop Offset="0" Color="Gray" />
                        <GradientStop Offset="1" Color="Transparent" />
                    </LinearGradientBrush>
                </ResourceDictionary>
                <ResourceDictionary x:Key="HighContrast">
                    <SolidColorBrush x:Key="HeaderGradient" Color="Transparent" />
                </ResourceDictionary>
            </ResourceDictionary.ThemeDictionaries>
            <DataTemplate x:Key="MainPageSoundTemplate" x:DataType="viewmodels:SoundViewModel">
                <GridViewItem Margin="8" AutomationProperties.Name="{x:Bind converters:LocalizationConverter.ConvertGridViewSoundName(IsCurrentlyPlaying, Unplayable, Name), Mode=OneWay}">
                    <GridViewItem.Resources>
                        <!--  These two removes the border on hover and on pressed  -->
                        <SolidColorBrush x:Key="SystemControlHighlightListLowBrush" Color="Transparent" />
                        <SolidColorBrush x:Key="SystemControlHighlightListMediumBrush" Color="Transparent" />
                    </GridViewItem.Resources>
                    <Grid
                        Width="280"
                        Height="160"
                        extensions:VisualExtensions.CenterPoint="140,80,0"
                        CornerRadius="8"
                        PointerEntered="GridScaleUp"
                        PointerExited="GridScaleNormal">
                        <animations:Implicit.Animations>
                            <animations:ScaleAnimation Duration="0:0:0.5" />
                        </animations:Implicit.Animations>
                        <Grid.Background>
                            <ImageBrush Stretch="UniformToFill">
                                <ImageBrush.ImageSource>
                                    <BitmapImage UriSource="{x:Bind ImagePath}" />
                                </ImageBrush.ImageSource>
                            </ImageBrush>
                        </Grid.Background>

                        <FontIcon
                            Margin="12"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Top"
                            FontFamily="{StaticResource FluentUIGlyphs}"
                            FontSize="32"
                            Foreground="White"
                            Glyph="&#xEB7D;"
                            Visibility="{x:Bind IsCurrentlyPlaying, Mode=OneWay}" />

                        <Grid VerticalAlignment="Bottom">
                            <Grid.Background>
                                <AcrylicBrush TintColor="{ThemeResource SystemChromeMediumLowColor}" TintOpacity="0.2" />
                            </Grid.Background>
                            <TextBlock
                                Margin="12,0,0,4"
                                FontFamily="Calibri"
                                FontSize="32"
                                Foreground="White"
                                Text="{x:Bind converters:LocalizationConverter.ConvertSoundName(Name)}"
                                TextWrapping="Wrap" />
                        </Grid>
                    </Grid>
                    <GridViewItem.ContextFlyout>
                        <muxc:CommandBarFlyout Placement="BottomEdgeAlignedLeft">
                            <muxc:CommandBarFlyout.SecondaryCommands>
                                <AppBarButton
                                    x:Uid="DeleteAppBarButton"
                                    Command="{x:Bind DeleteCommand}"
                                    Icon="Delete"
                                    Visibility="{x:Bind CanDelete}" />
                                <AppBarElementContainer>
                                    <StackPanel Width="300" Margin="12">
                                        <TextBlock x:Uid="Copyright" FontWeight="SemiBold" />
                                        <TextBlock
                                            Margin="0,8,0,0"
                                            IsTextSelectionEnabled="True"
                                            Text="{x:Bind Attribution}"
                                            TextWrapping="Wrap" />
                                    </StackPanel>
                                </AppBarElementContainer>
                            </muxc:CommandBarFlyout.SecondaryCommands>
                        </muxc:CommandBarFlyout>
                    </GridViewItem.ContextFlyout>
                </GridViewItem>
            </DataTemplate>
        </ResourceDictionary>
    </Page.Resources>

    <Grid Padding="0,32,0,0">
        <Grid.RowDefinitions>
            <RowDefinition Height="60" />
            <RowDefinition Height="*" />
            <RowDefinition Height="{StaticResource HeaderHeight}" />
        </Grid.RowDefinitions>

        <Grid
            Margin="40,0"
            VerticalAlignment="Center"
            Canvas.ZIndex="1">
            <StackPanel
                HorizontalAlignment="Left"
                VerticalAlignment="Top"
                Orientation="Horizontal">
                <controls:LogoControl />
                <TextBlock
                    Margin="8,0,0,0"
                    FontFamily="Calibri"
                    FontSize="32"
                    Text="Ambie" />
                <controls:ViewCatalogueButton Margin="8,0,0,0" IconOnly="True" />
                <controls:SleepTimerControl Margin="4,0,0,0" />
                <controls:MoreButton Margin="4,0,0,0" />
            </StackPanel>

            <StackPanel
                HorizontalAlignment="Right"
                VerticalAlignment="Top"
                Orientation="Horizontal" />
        </Grid>

        <controls:SoundGridControl
            Grid.Row="1"
            ItemTemplate="{StaticResource MainPageSoundTemplate}"
            ShowCatalogueButton="True" />

        <Grid
            Grid.Row="2"
            Padding="40,0"
            Background="{ThemeResource SystemControlChromeHighAcrylicElementMediumBrush}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="auto" />
            </Grid.ColumnDefinitions>

            <StackPanel Orientation="Horizontal">
                <controls:PlayerControl />
            </StackPanel>

            <controls:ActiveTrackList Grid.Column="1" Margin="12,0,0,0" />



        </Grid>

        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup>
                <VisualState>
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="800" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="TitleCentre.Visibility" Value="Visible" />
                    </VisualState.Setters>
                </VisualState>

                <VisualState>
                    <VisualState.StateTriggers>
                        <statetriggers:TenFootTrigger />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="TitleCentre.Visibility" Value="Visible" />
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>
    </Grid>
</Page>
